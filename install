#!/bin/sh
echo "Docker"
rm -f /var/lib/pacman/sync/*
pacman -Syy
pacman --noconfirm -S git
pacman --noconfirm -S docker-compose
pacman --noconfirm -S docker
systemctl start docker.service
systemctl enable docker.service

echo "Clone Source"
git clone https://github.com/code-SL/tidal-connect-docker
cd /tmp
wget https://raw.githubusercontent.com/lovehifi/tidal-raudio-pi4/main/entrypoint.sh
chmod -R 755 /tmp/entrypoint.sh
cp -f /tmp/entrypoint.sh /root/tidal-connect-docker/Docker/
cd /root/tidal-connect-docker
wget https://raw.githubusercontent.com/lovehifi/tidal-raudio-pi4/main/install.sh
chmod -R 755 install.sh

echo "Build Docker"
cd Docker
./build_docker.sh
cd ..
./install.sh
sleep 1

echo "Remove the text ipv6.disable=1 in /boot/cmdline.txt"
cp /boot/cmdline.txt /boot/cmdline.txt.backup && sed -i '0,/ipv6.disable=1/{s/ipv6.disable=1//}' /boot/cmdline.txt
sleep 1
#cp /root/tidal-connect-docker/Docker/entrypoint.sh /root/tidal-connect-docker/Docker/entrypoint.sh.backup
#sleep 1
#echo "Change the Tidal Connect - Name"
#sed -i 's/HiFiBerry/rAudio/g' /root/tidal-connect-docker/Docker/entrypoint.sh
#sleep 1
reboot
